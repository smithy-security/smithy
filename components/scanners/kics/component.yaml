name: "kics"
description: "Static analysis for Infrastructure as code."
type: "scanner"
steps:
  - name: "run-kics"
    image: "checkmarx/kics:v2.1.14"
    executable: "/bin/sh"
    args:
      - "-c"
      # EDITED: CD into the source code first, then run the scan.
      # This changes the "Execution Root" for the kics process.
      - |
        cd {{ scratchWorkspace }} && \
        /app/bin/kics scan \
        --ignore-on-exit=results \
        --output-path=. \
        --parallel=0 \
        --path=. \
        --payload-lines \
        --report-formats=sarif \
        --ci
  - name: "parser"
    image: "components/scanners/kics"
    env_vars:
      KICS_RAW_OUT_FILE_PATH: "{{ scratchWorkspace }}/results.sarif"
      KICS_WORKSPACE_PATH: "{{ sourceCodeWorkspace }}"
    executable: "/bin/app"
