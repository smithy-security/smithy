---
name: trivy
description: "Scan for vulnerabilities and misconfigurations in code repositories, binary artifacts, container images and Kubernetes clusters."
type: scanner
parameters:
  - name: image
    type: string
    value: "{{ sourceCodeWorkspace }}/image.tar"
  - name: trivy_username
    type: string
    value: ""
  - name: trivy_password
    type: string
    value: ""
steps:
  - name: run-trivy
    image: components/scanners/trivy/scanner
    executable: /bin/sh
    args:
    - -c
    - /entrypoint.sh "{{ sourceCodeWorkspace }}/trivy-out.sarif.json" "{{ .parameters.image }}"
    env_vars:
      TRIVY_USERNAME: "{{ .parameters.trivy_username}}"
      TRIVY_PASSWORD: "{{ .parameters.trivy_password}}"
  - name: parser
    image: components/scanners/trivy/parser
    executable: /bin/app
    env_vars:
      TRIVY_RAW_OUT_FILE_PATH: "{{ sourceCodeWorkspace }}/trivy-out.sarif.json"
