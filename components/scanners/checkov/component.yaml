name: "checkov"
description: "Static code analysis for infrastructure as code. Finds misconfigurations that may lead to security or compliance problems."
type: "scanner"
steps:
  - name: "run-checkov"
    image: "bridgecrew/checkov:3.2.473"
    executable: "/bin/sh"
    args:
    - "-c"
    - >
      cd {{ sourceCodeWorkspace }} &&
      /usr/local/bin/checkov \
        -d . \
        -o=sarif \
        --output-file-path={{ scratchWorkspace }} \
        --soft-fail
    # - "--scan-secrets-history"
    # - "--secrets-history-timeout=10m"
  - name: "parser"
    image: "components/scanners/checkov"
    env_vars:
      CHECKOV_RAW_OUT_FILE_PATH: "{{ scratchWorkspace }}/results_sarif.sarif"
      CHECKOV_WORKSPACE_PATH: "{{ sourceCodeWorkspace }}"
    executable: "/bin/app"
