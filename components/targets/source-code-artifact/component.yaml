name: "source-code-artifact"
description: "Downloads archived files in zip, tag or targz format from a plain http or s3 compatible API"
type: "target"
parameters:
  # Must be a valid url like: https://github.com/aws/aws-sdk-go-v2/archive/refs/heads/main.zip
  # Or a s3 compatible url like: s3://my-bucket/my-archive.tar or gs://my-bucket/my-archive.tar.gz
  - name: "artifact_url"
    type: "string"
    value: ""
  # This is an optional parameter that specifies the extension of the artifact.
  - name: "artifact_extension"
    type: "string"
    value: ""
  - name: "artifact_reference"
    type: "string"
    value: ""
  - name: "artifact_registry_region"
    type: "string"
    value: ""
  - name: "auth_id"
    type: "string"
    value: ""
  - name: "auth_secret"
    type: "string"
    value: ""
steps:
  - name: "download-and-unpack"
    env_vars:
      ARCHIVE_PATH: "{{ scratchWorkspace }}/archive"
      SOURCE_CODE_PATH: "{{ sourceCodeWorkspace }}"
      METADATA_PATH: "{{ targetMetadataWorkspace }}/target.json"
      ARTIFACT_URL: "{{ .parameters.artifact_url }}"
      ARTIFACT_EXTENSION: "{{ .parameters.artifact_extension }}"
      ARTIFACT_REFERENCE: "{{ .parameters.artifact_reference }}"
      ARTIFACT_REGISTRY_REGION: "{{ .parameters.artifact_registry_region }}"
      ARTIFACT_REGISTRY_AUTH_ID: "{{ .parameters.auth_id }}"
      ARTIFACT_REGISTRY_AUTH_SECRET: "{{ .parameters.auth_secret }}"
    image: "components/targets/source-code-artifact"
    executable: "/bin/app"
