# Smithy-gen

This package contains the code that gets automatically generated by buf for the smithy protos. It gets used by the smithy python sdk and therefore is a python package itself.

To regenerate the code, you can simply run the preconfigured `make` target:

```bash
make generate-proto
```

This will run the `buf generate` command, which will generate the code in the `smithy-gen` package.

## Usage

You can use the generated code by simply installing the `smithy-gen` package in your python environment:

```bash
poetry add "git+https://github.com/smithy-security/smithy.git@<sdk-tag>#subdirectory=sdk/smithy-gen"
# or
pip install "git+https://github.com/smithy-security/smithy.git@<sdk-tag>#subdirectory=sdk/smithy-gen"
```

**ATTENTION:** Make sure to replace `<sdk-tag>` with the actual tag you want to use, e.g. `sdk/v0.0.18-alpha`. You can find the available tags by running:

```bash
git ls-remote --tags --refs https://github.com/smithy-security/smithy.git 'refs/tags/sdk/*'
```

This will list all the tags that start with `sdk/`. You can then choose the latest tag that fits your needs and use it in the installation command.
If you just want to use the latest version, you can also use the `main` branch, but we recommend using a tagged version for stability.

Alternatively, you can use the following snippet to automatically fetch the latest tag:

```bash
latest_tag=$(                           
  git ls-remote --tags --refs https://github.com/smithy-security/smithy.git 'refs/tags/sdk/*' |
  cut -f2 |
  sed 's#refs/tags/##' |
  sort -V | tail -n1
)
poetry add "git+https://github.com/smithy-security/smithy.git@$latest_tag#subdirectory=sdk/smithy-gen"
```

(exchange `poetry add` with `pip install` if you prefer pip)
